@page "/VirtualFarm"
@inject IJSRuntime JSRuntime

<MudContainer>
    <MudItem xs="12">
        <MudPaper>
            <h3>3D Dashboard</h3>

            <!-- Unity 크기 조정 입력 필드 -->
            <div>
                <label for="widthInput">Width: </label>
                <input id="widthInput" type="number" @bind="width" @oninput="ResizeUnity" />
                <label for="heightInput">Height: </label>
                <input id="heightInput" type="number" @bind="height" @oninput="ResizeUnity" />
            </div>

            <div id="unity-container" class="unity-desktop" style="width: @(width)px; height: @(height)px;">
                <canvas id="unity-canvas" width="@width" height="@height"></canvas>
                <div id="unity-loading-bar" style="display:none;">
                    <div id="unity-logo"></div>
                    <div id="unity-progress-bar-empty">
                        <div id="unity-progress-bar-full"></div>
                    </div>
                </div>
                <div id="unity-warning"></div>
                <div id="unity-footer">
                    <div id="unity-webgl-logo"></div>
                    <div id="unity-fullscreen-button"></div>
                    <div id="unity-build-title">farmTest240531</div>
                </div>
            </div>
        </MudPaper>
    </MudItem>
</MudContainer>
<button @onclick="SetUnityFullscreen">전체 화면</button>
@code {
    private int width { get; set; } = 1920; // 기본값
    private int height { get; set; } = 1080; // 기본값

    private async Task ResizeUnity(ChangeEventArgs e)
    {
        // Unity 창 크기 조정
        await JSRuntime.InvokeVoidAsync("resizeUnityCanvas", width, height);
    }
    private async Task SetUnityFullscreen ()
    {
        await JSRuntime.InvokeVoidAsync("setUnityFullscreen");

    }
    protected override async Task OnAfterRenderAsync (bool firstRender)
    {
        if (firstRender)
        {
            // Unity 인스턴스 로드
            await JSRuntime.InvokeVoidAsync("loadUnityInstance",
                "#unity-container", "#unity-canvas", "#unity-loading-bar",
                "#unity-progress-bar-full", "#unity-fullscreen-button", "#unity-warning");
        }
    }
}
